{"ast":null,"code":"import _regeneratorRuntime from \"/Users/oche/Projects/Targetometer/Client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/oche/Projects/Targetometer/Client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/oche/Projects/Targetometer/Client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport createDataContext from \"./createDataContext\";\nimport trackerApi from \"../api/tracker\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { navigate } from \"../navigationRef\";\n\nvar authReducer = function authReducer(state, action) {\n  switch (action.type) {\n    case 'add_error':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: action.payload\n      });\n\n    case 'signup':\n      return {\n        errorMessage: ''\n      };\n\n    case 'signin':\n      return {\n        errorMessage: '',\n        token: action.payload\n      };\n\n    case 'confirmation':\n      return {\n        errorMessage: '',\n        response: action.payload\n      };\n\n    case 'signout':\n      return {\n        token: null,\n        errorMessage: ''\n      };\n\n    case 'clear_error_message':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: ''\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar signup = function signup(dispatch) {\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n      var phone, password, name, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              phone = _ref.phone, password = _ref.password, name = _ref.name;\n              _context.prev = 1;\n              _context.next = 4;\n              return trackerApi.post('/auth/createaccount', {\n                phone: phone,\n                password: password,\n                name: name\n              });\n\n            case 4:\n              response = _context.sent;\n              navigate('VerifyAccount'); // navigation.navigate('VerifyAccount')\n\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              dispatch({\n                type: 'add_error',\n                payload: 'Something went wrong with signup'\n              });\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 8]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n};\n\nvar signin = function signin(dispatch) {\n  return /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3) {\n      var phone, password, response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              phone = _ref3.phone, password = _ref3.password;\n              _context2.prev = 1;\n              _context2.next = 4;\n              return trackerApi.post('/auth/login', {\n                phone: phone,\n                password: password\n              });\n\n            case 4:\n              response = _context2.sent;\n              _context2.next = 7;\n              return AsyncStorage.setItem('token', response.data.token);\n\n            case 7:\n              _context2.next = 9;\n              return AsyncStorage.setItem('username', response.data.user.username);\n\n            case 9:\n              dispatch({\n                type: 'signin',\n                payload: response.data.result\n              }); // console.log(response.data) \n              // let user = await AsyncStorage.getItem('user')\n              // console.log(response.data.token)\n\n              navigate('Home', {\n                Screen: \"HomeScreen\"\n              }); //    console.log('user succesfully logged in')\n              // console.log(`the token is ${jwttoken}`)\n\n              _context2.next = 16;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](1);\n              // console.log(err)\n              dispatch({\n                type: 'add_error',\n                payload: _context2.t0.message\n              });\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 13]]);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n};\n\nvar tryLocalSignin = function tryLocalSignin(dispatch) {\n  return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var token;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return AsyncStorage.getItem('token');\n\n          case 2:\n            token = _context3.sent;\n\n            if (token) {\n              dispatch({\n                type: 'signin',\n                payload: token\n              });\n              navigate('Home', {\n                Screen: \"HomeScreen\"\n              });\n            } else {\n              navigate('SignIn');\n            }\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n};\n\nvar confirmOtp = function confirmOtp(dispatch) {\n  return /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref6) {\n      var token, response;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              token = _ref6.token;\n              _context4.prev = 1;\n              _context4.next = 4;\n              return trackerApi.post('/auth/confirmphone', {\n                token: token\n              });\n\n            case 4:\n              response = _context4.sent;\n              dispatch({\n                type: 'confirmation',\n                payload: response.data\n              });\n              navigate('Confirmation');\n              _context4.next = 12;\n              break;\n\n            case 9:\n              _context4.prev = 9;\n              _context4.t0 = _context4[\"catch\"](1);\n              dispatch({\n                type: 'add_error',\n                payload: 'Something Went Wrong with Confirming code'\n              });\n\n            case 12:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[1, 9]]);\n    }));\n\n    return function (_x3) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n};\n\nvar signout = function signout(dispatch) {\n  return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return AsyncStorage.removeItem('token');\n\n          case 2:\n            dispatch({\n              type: 'signout'\n            }); // console.log('user has been logged out')\n\n            navigate('Authentication', {\n              screen: 'SignIn'\n            }); // handle error if sign out  fails\n\n          case 4:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n};\n\nvar clearErrorMessage = function clearErrorMessage(dispatch) {\n  return function () {\n    dispatch({\n      type: 'clear_error_message'\n    });\n  };\n};\n\nvar _createDataContext = createDataContext(authReducer, {\n  signin: signin,\n  signout: signout,\n  signup: signup,\n  confirmOtp: confirmOtp,\n  clearErrorMessage: clearErrorMessage,\n  tryLocalSignin: tryLocalSignin\n}, {\n  token: null,\n  errorMessage: '',\n  username: null\n}),\n    Provider = _createDataContext.Provider,\n    Context = _createDataContext.Context;\n\nexport { Provider, Context };","map":{"version":3,"sources":["/Users/oche/Projects/Targetometer/Client/context/AuthContext.js"],"names":["createDataContext","trackerApi","AsyncStorage","navigate","authReducer","state","action","type","errorMessage","payload","token","response","signup","dispatch","phone","password","name","post","signin","setItem","data","user","username","result","Screen","message","tryLocalSignin","getItem","confirmOtp","signout","removeItem","screen","clearErrorMessage","Provider","Context"],"mappings":"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","sourcesContent":["import createDataContext from \"./createDataContext\";\nimport trackerApi from \"../api/tracker\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { navigate } from \"../navigationRef\";\n\nconst authReducer = (state, action) =>{\n    switch (action.type){\n        case 'add_error':\n            return {...state, errorMessage: action.payload }\n        case 'signup':\n            return{errorMessage: ''}\n        case 'signin':\n            return{errorMessage: '', token: action.payload}\n        case 'confirmation':\n            return{errorMessage: '', response: action.payload}\n        case 'signout':\n            return{token: null, errorMessage: ''}\n        case 'clear_error_message':\n            return {...state, errorMessage: ''}\n        default:\n            return state\n    }\n}\n\nconst signup = (dispatch) => {\n    return async ({phone, password, name}) => {\n        // make api request with phone and password\n        try{\n            const response = await trackerApi.post('/auth/createaccount', {phone, password, name})\n            \n            navigate('VerifyAccount')\n            // navigation.navigate('VerifyAccount')\n        }catch (err) {\n           \n            dispatch({\n                type: 'add_error', \n                payload: 'Something went wrong with signup'\n            })\n        }\n        // after signing up modify state\n\n        // handle error if signup fails\n    }\n    \n}\n\nconst signin = (dispatch) =>{\n    return async ({phone, password}) => {\n        // make api request with phone and password\n        try{\n            // console.log('button fired')\n            const response = await trackerApi.post('/auth/login', {phone, password})\n            await AsyncStorage.setItem('token', response.data.token)\n            await AsyncStorage.setItem('username', response.data.user.username )\n            dispatch({type: 'signin', payload: response.data.result})\n            // console.log(response.data) \n            // let user = await AsyncStorage.getItem('user')\n            // console.log(response.data.token)\n            navigate('Home',{Screen:\"HomeScreen\"})\n            \n        //    console.log('user succesfully logged in')\n            \n            // console.log(`the token is ${jwttoken}`)\n        }catch(err){\n            // console.log(err)\n            dispatch({\n                type: 'add_error',\n                payload: err.message\n            })\n        }\n        // let user = await AsyncStorage.getItem('user')\n        // console.log(user)\n        // console.log('user succesfully logged in')\n        // after signing in modify state\n\n        // handle error if signin  fails\n    }\n}\n\n\nconst tryLocalSignin = dispatch => async() =>{\n    const token = await AsyncStorage.getItem('token')\n    if (token){\n        dispatch({type: 'signin', payload: token})\n        navigate('Home',{Screen:\"HomeScreen\"})\n    } else {\n        navigate('SignIn')\n    }\n}\n\nconst confirmOtp = (dispatch) => {\n    return async({token}) => {\n        // make api request with otp token\n        try{\n            const response = await trackerApi.post('/auth/confirmphone', {token})\n            dispatch({type: 'confirmation', payload: response.data})\n            navigate('Confirmation')\n        }catch(error){\n            dispatch({\n                type: 'add_error',\n                payload: 'Something Went Wrong with Confirming code'\n            })\n        }\n\n        // handle error if signin  fails\n    }\n}\n\n\nconst signout = (dispatch) =>{\n    return async() => {\n        // make api request with phone and password\n        await AsyncStorage.removeItem('token')\n        dispatch({type: 'signout'})\n        // console.log('user has been logged out')\n        navigate('Authentication', {screen: 'SignIn'})\n        // handle error if sign out  fails\n    }\n}\n\nconst clearErrorMessage = dispatch => () => {\n    dispatch({type: 'clear_error_message'})\n}\n\nexport const {Provider, Context} = createDataContext(\n    authReducer,\n    { signin, signout, signup, confirmOtp, clearErrorMessage, tryLocalSignin },\n    {token: null, errorMessage: '', username:null}\n)"]},"metadata":{},"sourceType":"module"}